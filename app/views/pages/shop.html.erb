<% content_for :title, "Shop â€¢ Reboot" %>
<% content_for :page, "shop" %>

<%= render "shared/navbar" %>

<main class="container">
  <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem;">
    <h1 class="page-title" style="margin: 0;">Shop</h1>
    <a href="/purchases" class="btn btn--accent btn--accent-gradient btn--xl btn--pill btn--glow" style="display:inline-flex;align-items:center;gap:10px;">
      <span>Recent Purchases</span>
    </a>
  </div>

  <div class="shop-layout">
    <aside class="shop-categories card">
      <h3 class="shop-heading">Category</h3>
      <ul class="shop-category-list">
        <% categories_active = [ "Keyboard", "Mouse", "Monitor", "Headphones", "Webcam" ] %>
        <% categories_soon = [ "Chair", "PC Components", "Desktop Accessories", "Suggest Something!" ] %>
        <% categories_active.each_with_index do |cat, idx| %>
          <li>
            <button class="shop-category-item <%= 'is-active' if idx == 0 %>" data-target="cat-<%= cat.downcase %>">
              <%= cat %>
            </button>
          </li>
        <% end %>
        <% categories_soon.each do |cat| %>
          <li>
            <button class="shop-category-item" disabled>
              <span class="shop-category-item__label"><%= cat %></span>
              <img
                src="https://files.slack.com/files-pri/T09V59WQY1E-F0A73PBKWEN/1000_f_108839823_c2hrfq0hbz7wkf6ngjesajlakz74zm7b.jpg?pub_secret=76883edfeb"
                alt="Coming Soon"
                class="shop-category-item__badge">
            </button>
          </li>
        <% end %>
      </ul>
    </aside>

    <section class="shop-items card">
      <div class="shop-items__header">
        <h2 class="shop-heading" style="margin: 0;">Items</h2>
        <div aria-hidden="true" class="shop-cart">
          <img src="https://files.slack.com/files-pri/T09V59WQY1E-F0A793FGJ2V/bolt.png?pub_secret=7acc4044c5" alt="bolts" class="bolt-icon">
        </div>
      </div>

      <% categories_active.each_with_index do |cat, idx| %>
        <% item = @shop_items.find { |i| i.name.to_s.downcase.strip == cat.downcase } %>
        <% base_cost = (item&.cost || 0).to_i %>
        <div id="cat-<%= cat.downcase %>" class="shop-item-detail <%= 'is-active' if idx == 0 %>">
          <div class="shop-item-detail__variants">
            <% variants = [
              ['Standard grant', 'standard'],
              ['Quality grant', 'quality'],
              ['Advanced grant', 'advanced'],
              ['Professional grant', 'professional']
            ] %>
            <% images_for_keyboard = [
              'https://files.slack.com/files-pri/T09V59WQY1E-F0A6SJ1AQAH/vecteezy_keyboard-3d-rendering-icon-illustration_28606613.png?pub_secret=9418a400cb',
              'https://files.slack.com/files-pri/T09V59WQY1E-F0A6SHUUGN9/vecteezy_gaming-keyboard-with-anti-ghosting-technology-transparent_57571865.png?pub_secret=2fe417ad9b',
              'https://files.slack.com/files-pri/T09V59WQY1E-F0A7QABPARW/vecteezy_rgb-illuminated-white-gaming-keyboard-top-view_52855142.png?pub_secret=3d3c0544c6',
              'https://files.slack.com/files-pri/T09V59WQY1E-F0A6EHQKAUF/vecteezy_white-rgb-mechanical-gaming-keyboard-with-cable_52855199.png?pub_secret=3e689005bb'
            ] if cat == 'Keyboard' %>
            <% images_for_mouse = [
              'https://files.slack.com/files-pri/T09V59WQY1E-F0A7QDJR56C/vecteezy_computer-mouse-isolated-on-a-transparent-background_47833235.png?pub_secret=206f7975e4',
              'https://files.slack.com/files-pri/T09V59WQY1E-F0A6PNNB8HH/vecteezy_ai-generated-computer-mouse-png-isolated-on-transparent_36113136.png?pub_secret=5328baa9cd',
              'https://files.slack.com/files-pri/T09V59WQY1E-F0A6ZMVP5RA/vecteezy_ai-generated-computer-mouse-png-isolated-on-transparent_36112700.png?pub_secret=4a6941278c',
              'https://files.slack.com/files-pri/T09V59WQY1E-F0A6ELUDWQP/vecteezy_ai-generated-computer-mouse-png-isolated-on-transparent_36112693.png?pub_secret=8a1b07b884'
            ] if cat == 'Mouse' %>
            <% images_for_monitor = [
              'https://files.slack.com/files-pri/T09V59WQY1E-F0A793DR88Z/10740609.png?pub_secret=edffb80446',
              'https://files.slack.com/files-pri/T09V59WQY1E-F0A6ZNZN99A/3d-monitor-curved-free-png.webp?pub_secret=9d8649f57c',
              'https://files.slack.com/files-pri/T09V59WQY1E-F0A6W5FN41Y/vecteezy_3d-monitor-for-office_53739745.png?pub_secret=6a16537f48',
              'https://files.slack.com/files-pri/T09V59WQY1E-F0A6EN1NVP1/vecteezy_sleek-black-computer-monitor-with-vibrant-red-abstract_56609224.png?pub_secret=5e30e2cd74'
            ] if cat == 'Monitor' %>
            <% images_for_headphones = [
              'https://files.slack.com/files-pri/T09V59WQY1E-F0A75HW036Y/vecteezy_sleek-white-wireless-headphones-premium-audio-bluetooth_55130517.png?pub_secret=51ed82f735',
              'https://files.slack.com/files-pri/T09V59WQY1E-F0A6VJMSHLK/vecteezy_modern-silver-headphones-for-audiophiles_51767617.png?pub_secret=c9009d25e9',
              'https://files.slack.com/files-pri/T09V59WQY1E-F0A6VJMAZRR/vecteezy_headphone-png-with-ai-generated_26773824.png?pub_secret=7edb592517',
              'https://files.slack.com/files-pri/T09V59WQY1E-F0A6ZUNQC8N/vecteezy_3d-gaming-headphone_53295526.png?pub_secret=72d6d1c41a'
            ] if cat == 'Headphones' %>
            <% images_for_webcam = [
              'https://files.slack.com/files-pri/T09V59WQY1E-F0A7W9U4HU0/vecteezy_ai-generated-security-camera-on-transparent-background-ai_39213084.png?pub_secret=0ec47b5d57',
              'https://files.slack.com/files-pri/T09V59WQY1E-F0A75J7CTDJ/vecteezy_high-definition-webcam-modern-design-sleek-silver-black_67821519.png?pub_secret=22c6d549e5',
              'https://files.slack.com/files-pri/T09V59WQY1E-F0A6VK098QK/vecteezy_sleek-modern-webcam-for-conferencing-and-streaming_60580277.png?pub_secret=02494c1a84',
              'https://files.slack.com/files-pri/T09V59WQY1E-F0A6ZV27UQN/vecteezy_camera-with-lens_54402726.png?pub_secret=6527a83f20'
            ] if cat == 'Webcam' %>
            <% variants.each_with_index do |(label_text, key), variant_idx| %>
              <% img_src = (
                (cat == 'Keyboard' && images_for_keyboard && images_for_keyboard[variant_idx]) ||
                (cat == 'Mouse' && images_for_mouse && images_for_mouse[variant_idx]) ||
                (cat == 'Monitor' && images_for_monitor && images_for_monitor[variant_idx]) ||
                (cat == 'Headphones' && images_for_headphones && images_for_headphones[variant_idx]) ||
                (cat == 'Webcam' && images_for_webcam && images_for_webcam[variant_idx]) ||
                '/images/signin/hackclub.svg'
              ) %>
              <% amount_map = { 'standard' => 50, 'quality' => 110, 'advanced' => 170, 'professional' => 230 } %>
              <% grant_amount = amount_map[key] || 0 %>
              <% bolts_map = { 'standard' => 500, 'quality' => 1100, 'advanced' => 1700, 'professional' => 2300 } %>
              <% base_bolts = bolts_map[key] || 0 %>
              <% price = base_bolts %>
              <% desc_text = "This item provide a #{grant_amount}$ HCB card grant to spend on a #{cat}" %>
              <div class="shop-variant">
                <div class="shop-variant__thumb">
                  <img src="<%= img_src %>" alt="<%= label_text %>">
                </div>
                <div class="shop-variant__name"><%= label_text %></div>
                <div class="shop-variant__meta">
                  <button type="button"
                          class="shop-variant__priceBox price-btn"
                          data-item-id="<%= item&.id %>"
                          data-name="<%= cat %>"
                          data-variant="<%= key %>"
                          data-display="<%= label_text %>"
                          data-price="<%= price %>"
                          data-grant="<%= grant_amount %>"
                          data-bolts="<%= base_bolts %>"
                          data-img="<%= img_src %>"
                          data-desc="<%= desc_text.to_s.gsub('\"','&quot;') %>">
                    <span class="shop-variant__price"><%= price %></span>
                    <img src="https://files.slack.com/files-pri/T09V59WQY1E-F0A793FGJ2V/bolt.png?pub_secret=7acc4044c5" alt="bolts" class="bolt-icon">
                  </button>
                  <span class="shop-variant__pill shop-variant__pill--<%= key %>"><%= label_text %></span>
                </div>

                <!-- Purchase action moved to modal -->
              </div>
            <% end %>
          </div>
        </div>
      <% end %>

      
    </section>
  </div>
</main>

<!-- Item Modal -->
<div id="shop-item-modal" class="modal modal--hidden" data-user-balance="<%= @current_user.balance.to_i %>">
  <div class="modal__backdrop"></div>
  <div class="modal__content card">
    <div class="modal__header">
      <h3 id="shop-modal-title" class="modal__title">Item</h3>
      <button type="button" class="modal__close" aria-label="Close">&times;</button>
    </div>
    <div class="shop-modal__body">
      <img id="shop-modal-image" class="shop-modal__image" src="/images/signin/hackclub.svg" alt="item">
      <p id="shop-modal-desc" class="shop-modal__desc muted">Description</p>
      <div class="shop-modal__qty" style="display:flex;align-items:center;gap:8px;">
        <label for="shop-modal-qty" class="muted">Quantity</label>
        <input id="shop-modal-qty" type="number" min="1" max="1" step="1" value="1" style="width:80px;" disabled>
      </div>
      <div class="shop-modal__price">
        <span id="shop-modal-price">0</span>
        <img src="https://files.slack.com/files-pri/T09V59WQY1E-F0A793FGJ2V/bolt.png?pub_secret=7acc4044c5" alt="bolts" class="bolt-icon">
      </div>
      <div id="shop-modal-warning" style="display:none;background:#fdecea;border:1px solid #f5c2c7;color:#842029;padding:8px 12px;border-radius:8px;">
        Not enough bolts to purchase. You need <strong><span id="shop-modal-shortage">0</span></strong> more.
      </div>
      <%= form_with url: purchase_path, method: :post, local: true, id: "shop-modal-form" do %>
        <input type="hidden" name="item_id" id="shop-modal-item-id" value="">
        <input type="hidden" name="category" id="shop-modal-category" value="">
        <input type="hidden" name="variant" id="shop-modal-variant" value="">
        <input type="hidden" name="quantity" id="shop-modal-quantity" value="1">
        <button id="shop-modal-buy" type="submit" class="btn btn--primary btn--block">Purchase</button>
      <% end %>
    </div>
  </div>
  <style>
    .shop-modal__body { display: grid; gap: 12px; }
    .shop-modal__image { width: 100%; height: 180px; border-radius: 10px; object-fit: cover; background: var(--paper-alt); }
    .shop-modal__price { display: inline-flex; align-items: center; gap: 8px; background: #efd1a4; padding: 8px 12px; border-radius: 12px; width: fit-content; }
  </style>
</div>
